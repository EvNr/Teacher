<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¹Ù„Ù…Ø© | Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© ØµØ§Ø¨Ø±ÙŠÙ†</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> <!-- For Analytics Charts -->
</head>
<body class="teacher-dashboard">
    <header>
        <nav>
            <div class="logo">Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© ØµØ§Ø¨Ø±ÙŠÙ† - Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¹Ù„Ù…Ø©</div>
            <button id="theme-toggle" class="theme-btn" aria-label="Toggle Dark Mode">ğŸŒ“</button>
            <ul>
                <li><a href="#" id="logout-btn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</a></li>
            </ul>
        </nav>
    </header>

    <main class="fade-in">
        <section class="dashboard-header">
            <h1>Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ Ø£Ø³ØªØ§Ø°Ø© ØµØ§Ø¨Ø±ÙŠÙ† ğŸ‘‹</h1>
            <p>Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© Ø¹Ù„Ù‰ Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø·Ø§Ù„Ø¨Ø§Øª ÙˆØ§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ©</p>
        </section>

        <div class="dashboard-grid">
            <!-- Student List Section -->
            <section class="section-block student-list-section">
                <h3>ğŸ‘©â€ğŸ“ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ø§Ù„Ø¨Ø§Øª ÙˆÙ†Ù‚Ø§Ø· XP</h3>
                <div class="filters">
                    <select id="grade-filter">
                        <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø±Ø§Ø­Ù„</option>
                        <option value="10">Ø£ÙˆÙ„ Ø«Ø§Ù†ÙˆÙŠ</option>
                        <option value="11">Ø«Ø§Ù†ÙŠ Ø«Ø§Ù†ÙˆÙŠ</option>
                        <option value="12">Ø«Ø§Ù„Ø« Ø«Ø§Ù†ÙˆÙŠ</option>
                    </select>
                </div>
                <div class="table-container">
                    <table id="students-table">
                        <thead>
                            <tr>
                                <th>Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨Ø©</th>
                                <th>Ø§Ù„Ù…Ø±Ø­Ù„Ø©</th>
                                <th>Ø§Ù„ÙØµÙ„ (Ø§Ù„Ø´Ø¹Ø¨Ø©)</th>
                                <th>Ø§Ù„Ù†Ù‚Ø§Ø· (XP)</th>
                                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Populated via JS -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Analytics Section -->
            <section class="section-block analytics-section">
                <h3>ğŸ“Š ØªØ­Ù„ÙŠÙ„ Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ù‚Ø¯Ø±Ø§Øª (Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ø´Ø¹Ø¨)</h3>
                <div class="charts-container">
                    <div class="chart-box">
                        <h4>Ø«Ø§Ù†ÙŠ Ø«Ø§Ù†ÙˆÙŠ (Ø£ vs Ø¨)</h4>
                        <canvas id="grade11Chart"></canvas>
                        <div class="stats-summary" id="stats-11"></div>
                    </div>
                    <div class="chart-box">
                        <h4>Ø«Ø§Ù„Ø« Ø«Ø§Ù†ÙˆÙŠ (Ø£ vs Ø¨)</h4>
                        <canvas id="grade12Chart"></canvas>
                        <div class="stats-summary" id="stats-12"></div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <footer>
        <p>&copy; 2025 Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© - Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© ØµØ§Ø¨Ø±ÙŠÙ† Ù„Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª (Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…)</p>
    </footer>

    <script src="js/data.js"></script>
    <script src="js/security.js"></script>
    <script>
        // Inline script for Teacher Logic to keep it separate/secure from main student logic
        document.addEventListener('DOMContentLoaded', () => {
            // Security Check
            const session = localStorage.getItem('teacherSession');
            if (!session) {
                window.location.href = 'login.html';
                return;
            }

            // Logout Logic
            document.getElementById('logout-btn').addEventListener('click', (e) => {
                e.preventDefault();
                if(confirm('ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ')) {
                    localStorage.removeItem('teacherSession');
                    window.location.href = 'index.html';
                }
            });

            renderStudents();
            renderCharts();

            // Dark Mode Logic (Reused)
            if (localStorage.getItem('darkMode') === 'enabled') {
                document.body.classList.add('dark-mode');
            }
            document.getElementById('theme-toggle').addEventListener('click', () => {
                document.body.classList.toggle('dark-mode');
                localStorage.setItem('darkMode', document.body.classList.contains('dark-mode') ? 'enabled' : 'disabled');
            });

            // Filter Logic
            document.getElementById('grade-filter').addEventListener('change', (e) => {
                renderStudents(e.target.value);
            });
        });

        function renderStudents(filter = 'all') {
            const tbody = document.querySelector('#students-table tbody');
            tbody.innerHTML = '';

            Object.values(MOCK_USERS).forEach(user => {
                if (filter !== 'all' && user.grade !== filter) return;

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${user.name}</td>
                    <td>${getGradeName(user.grade)}</td>
                    <td><span class="badge badge-section">${user.section || 'Ø¹Ø§Ù…'}</span></td>
                    <td><span class="badge badge-xp">${user.xp || 0} XP</span></td>
                    <td><span class="status-dot online"></span> Ù†Ø´Ø·</td>
                `;
                tbody.appendChild(row);
            });
        }

        function getGradeName(grade) {
            if(grade === "10") return "Ø£ÙˆÙ„ Ø«Ø§Ù†ÙˆÙŠ";
            if(grade === "11") return "Ø«Ø§Ù†ÙŠ Ø«Ø§Ù†ÙˆÙŠ";
            if(grade === "12") return "Ø«Ø§Ù„Ø« Ø«Ø§Ù†ÙˆÙŠ";
            return grade;
        }

        function renderCharts() {
            // Grade 11 Analysis
            const ctx11 = document.getElementById('grade11Chart').getContext('2d');
            const data11 = MOCK_CLASS_RESULTS["11"];

            new Chart(ctx11, {
                type: 'bar',
                data: {
                    labels: ['Ø§Ù„Ù…ØªÙˆØ³Ø· (Ø£)', 'Ø§Ù„Ù…ØªÙˆØ³Ø· (Ø¨)', 'Ø§Ù„Ø£Ø¹Ù„Ù‰ (Ø£)', 'Ø§Ù„Ø£Ø¹Ù„Ù‰ (Ø¨)'],
                    datasets: [{
                        label: 'Ø§Ù„Ø¯Ø±Ø¬Ø© (Ù…Ù† 100)',
                        data: [data11.A.avg, data11.B.avg, data11.A.high, data11.B.high],
                        backgroundColor: ['#3498db', '#e74c3c', '#2980b9', '#c0392b']
                    }]
                },
                options: { scales: { y: { beginAtZero: true, max: 100 } } }
            });

            document.getElementById('stats-11').innerHTML = `
                <p><strong>Ø§Ù„Ø£Ø¹Ù„Ù‰:</strong> ${data11.A.avg > data11.B.avg ? 'Ø´Ø¹Ø¨Ø© Ø£' : 'Ø´Ø¹Ø¨Ø© Ø¨'}</p>
                <p>Ù…ØªÙˆØ³Ø· Ø£: ${data11.A.avg}% | Ù…ØªÙˆØ³Ø· Ø¨: ${data11.B.avg}%</p>
            `;

            // Grade 12 Analysis
            const ctx12 = document.getElementById('grade12Chart').getContext('2d');
            const data12 = MOCK_CLASS_RESULTS["12"];

            new Chart(ctx12, {
                type: 'bar',
                data: {
                    labels: ['Ø§Ù„Ù…ØªÙˆØ³Ø· (Ø£)', 'Ø§Ù„Ù…ØªÙˆØ³Ø· (Ø¨)', 'Ø§Ù„Ø£Ø¹Ù„Ù‰ (Ø£)', 'Ø§Ù„Ø£Ø¹Ù„Ù‰ (Ø¨)'],
                    datasets: [{
                        label: 'Ø§Ù„Ø¯Ø±Ø¬Ø© (Ù…Ù† 100)',
                        data: [data12.A.avg, data12.B.avg, data12.A.high, data12.B.high],
                        backgroundColor: ['#2ecc71', '#f1c40f', '#27ae60', '#f39c12']
                    }]
                },
                options: { scales: { y: { beginAtZero: true, max: 100 } } }
            });

            document.getElementById('stats-12').innerHTML = `
                <p><strong>Ø§Ù„Ø£Ø¹Ù„Ù‰:</strong> ${data12.A.avg > data12.B.avg ? 'Ø´Ø¹Ø¨Ø© Ø£' : 'Ø´Ø¹Ø¨Ø© Ø¨'}</p>
                <p>Ù…ØªÙˆØ³Ø· Ø£: ${data12.A.avg}% | Ù…ØªÙˆØ³Ø· Ø¨: ${data12.B.avg}%</p>
            `;
        }
    </script>
</body>
</html>
